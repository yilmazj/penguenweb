<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nihilist Penguin: The Endless Walk</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #e0f7fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        #game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* Joystick Alanı */
        #joystick-zone {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 10;
        }

        /* Giriş Ekranı */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            backdrop-filter: blur(5px);
        }
        
        h1 { color: #333; font-weight: 200; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; text-align: center;}
        p { color: #666; max-width: 300px; text-align: center; margin-bottom: 30px; line-height: 1.6;}
        
        button {
            padding: 15px 40px;
            background: #222;
            color: #fff;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        button:active { transform: scale(0.95); }

        /* Yükleme barı */
        #loading { position: absolute; top: 10px; left: 10px; color: #aaa; font-size: 10px; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
</head>
<body>

    <div id="start-screen">
        <h1>Nihilist Penguin</h1>
        <p>Yürüyoruz. Bir yere varmak için değil, sadece durmamak için.<br><br>Sürü orada. Ufukta. Asla ulaşamayacaksın.</p>
        <button id="start-btn">Yürüyüşe Başla</button>
    </div>

    <div id="game-container"></div>
    <div id="joystick-zone"></div>
    <div id="loading">v0.1 Demo</div>

    <script>
        // --- DEĞİŞKENLER VE AYARLAR ---
        let scene, camera, renderer;
        let penguin, penguinGroup;
        let ground, mountains = [];
        let distantCrowd;
        let clock = new THREE.Clock();
        let joystickManager;
        let moveData = { x: 0, y: 0 }; // Joystick verisi
        let isWalking = false;
        let walkSpeed = 0;
        const MAX_SPEED = 0.8; // Yavaş yürüyüş hızı
        
        // --- BAŞLATMA ---
        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('start-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-screen').style.display = 'none';
                initGame();
            }, 500);
        });

        function initGame() {
            // 1. Sahne Kurulumu
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xd6eef5); // Buzul mavisi gökyüzü
            scene.fog = new THREE.FogExp2(0xd6eef5, 0.0008); // Sis efekti (sonsuzluk hissi)

            // 2. Kamera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
            camera.position.set(0, 15, -40); // Penguenin arkasında ve biraz yukarıda
            camera.lookAt(0, 5, 50);

            // 3. Işıklandırma
            const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);
            scene.add(hemiLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(-100, 200, -100);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // 4. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('game-container').appendChild(renderer.domElement);

            // 5. Zemin (Sonsuz döngü için texture kaydıracağız)
            // Basit bir beyaz materyal
            const planeGeometry = new THREE.PlaneGeometry(1000, 1000, 100, 100);
            
            // Zemine biraz engebe verelim (vertices manipülasyonu)
            const positionAttribute = planeGeometry.attributes.position;
            for ( let i = 0; i < positionAttribute.count; i ++ ) {
                const z = positionAttribute.getZ( i );
                // Hafif dalgalanma
                positionAttribute.setZ( i, z + (Math.random() * 1.5) );
            }
            
            const planeMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff, 
                roughness: 1,
                flatShading: true
            });
            ground = new THREE.Mesh(planeGeometry, planeMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // 6. Dağlar (Sıradağlar)
            createMountains();

            // 7. Penguen (Procedural - Kod ile oluşturulmuş basit model)
            createPenguin();

            // 8. Uzaktaki Sürü (Kuzey Yönünde - Z ekseninde pozitif)
            createDistantCrowd();

            // 9. Joystick Kurulumu
            setupJoystick();

            // 10. Loop Başlat
            animate();
            
            // Resize handler
            window.addEventListener('resize', onWindowResize, false);
        }

        function createPenguin() {
            penguinGroup = new THREE.Group();

            const blackMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.5 });
            const whiteMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.5 });
            const orangeMat = new THREE.MeshStandardMaterial({ color: 0xff9800 });

            // Gövde (Kapsül benzeri silindir)
            const bodyGeo = new THREE.CylinderGeometry(3, 4, 10, 12);
            const body = new THREE.Mesh(bodyGeo, blackMat);
            body.position.y = 5;
            body.castShadow = true;
            penguinGroup.add(body);

            // Göbek (Beyaz)
            const bellyGeo = new THREE.CylinderGeometry(2, 3.5, 8, 12, 1, false, 0, Math.PI);
            const belly = new THREE.Mesh(bellyGeo, whiteMat);
            belly.position.set(0, 5, 0.6); // Hafif öne
            belly.rotation.y = 0; // Zaten silindir
            penguinGroup.add(belly);

            // Kafa
            const headGeo = new THREE.SphereGeometry(2.8, 16, 16);
            const head = new THREE.Mesh(headGeo, blackMat);
            head.position.y = 10.5;
            penguinGroup.add(head);

            // Gaga
            const beakGeo = new THREE.ConeGeometry(0.5, 2, 8);
            const beak = new THREE.Mesh(beakGeo, orangeMat);
            beak.position.set(0, 10.5, 2.8);
            beak.rotation.x = Math.PI / 2;
            penguinGroup.add(beak);

            // Kollar (Kanatlar) - Çapraz yere bakacak
            const wingGeo = new THREE.BoxGeometry(1, 6, 2);
            const leftWing = new THREE.Mesh(wingGeo, blackMat);
            leftWing.position.set(3.5, 6, 0);
            leftWing.rotation.z = -Math.PI / 6; // Yana açık
            leftWing.name = "leftWing"; // Animasyon için isim
            penguinGroup.add(leftWing);

            const rightWing = new THREE.Mesh(wingGeo, blackMat);
            rightWing.position.set(-3.5, 6, 0);
            rightWing.rotation.z = Math.PI / 6;
            rightWing.name = "rightWing";
            penguinGroup.add(rightWing);

            scene.add(penguinGroup);
            penguin = penguinGroup;
        }

        function createMountains() {
            // Sıradağlar (Merkezden 1500-4000 birim uzaklıkta)
            // Sadece görsel dekor, oyuncuya yaklaşmazlar (veya sonsuz döngüde geri ışınlanırlar)
            
            const mountainGeo = new THREE.ConeGeometry(100, 300, 4); // Low poly dağ
            const mountainMat = new THREE.MeshStandardMaterial({ color: 0xf0f8ff, flatShading: true });

            for (let i = 0; i < 40; i++) {
                const mesh = new THREE.Mesh(mountainGeo, mountainMat);
                
                // Rastgele pozisyon (Oyuncunun etrafında değil, sadece ufukta)
                // Kuzey yönü (Z+) ve yanlar
                const angle = Math.random() * Math.PI; // Sadece ön taraf 180 derece
                const dist = 1500 + Math.random() * 2500;
                
                mesh.position.x = Math.cos(angle) * dist * 2; // Geniş yayılım
                mesh.position.z = Math.abs(Math.sin(angle) * dist) + 500; // Hep ileri
                mesh.position.y = -50; // Biraz gömülü
                
                // Rastgele ölçek
                const scale = 1 + Math.random() * 2;
                mesh.scale.set(scale, scale, scale);
                
                scene.add(mesh);
                mountains.push(mesh);
            }
        }

        function createDistantCrowd() {
            // 200 kişilik sürü - Çok uzakta (Z = 2000 civarı)
            // Performans için InstancedMesh kullanabilirdik ama basitlik adına grup yapıyoruz.
            const crowdGroup = new THREE.Group();
            const simplePenguinGeo = new THREE.CapsuleGeometry(2, 6, 2, 8);
            const simpleMat = new THREE.MeshBasicMaterial({ color: 0x000000 }); // Sadece siluet

            for (let i = 0; i < 200; i++) {
                const mesh = new THREE.Mesh(simplePenguinGeo, simpleMat);
                // Dip dibe, yan yana
                mesh.position.x = (Math.random() - 0.5) * 200; // X ekseninde 200 birimlik alana yayıl
                mesh.position.z = (Math.random()) * 50; // Derinlik az, kalabalık hissi
                mesh.rotation.z = (Math.random() - 0.5) * 0.2; // Hafif sağa sola yatık duruş
                crowdGroup.add(mesh);
            }

            crowdGroup.position.set(0, 3, 2000); // 2000 birim uzakta
            scene.add(crowdGroup);
            distantCrowd = crowdGroup;
        }

        function setupJoystick() {
            const zone = document.getElementById('joystick-zone');
            
            // Şeffaf Premium Joystick Stili
            const options = {
                zone: zone,
                mode: 'static',
                position: { left: '50%', top: '50%' },
                color: 'white',
                size: 100
            };

            joystickManager = nipplejs.create(options);

            joystickManager.on('move', function (evt, data) {
                if (data && data.vector) {
                    moveData.x = data.vector.x;
                    moveData.y = data.vector.y;
                    isWalking = true;
                    // Hızı vektör büyüklüğüne göre ayarla ama max hızı geçme
                    walkSpeed = Math.min(data.distance / 50, 1) * MAX_SPEED; 
                }
            });

            joystickManager.on('end', function () {
                isWalking = false;
                moveData.x = 0;
                moveData.y = 0;
                walkSpeed = 0;
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- ANA DÖNGÜ VE ANİMASYON ---
        function animate() {
            requestAnimationFrame(animate);

            const time = clock.getElapsedTime();
            const delta = clock.getDelta();

            if (isWalking && penguinGroup) {
                // 1. YÜRÜYÜŞ ANİMASYONU (PROSEDÜREL)
                // Waddle efekti: Sağa sola yatma
                // Sağ ayak yerdeyken (sin > 0) -> Sola yat (Rotation Z pozitif)
                // Sol ayak yerdeyken (sin < 0) -> Sağa yat (Rotation Z negatif)
                
                const waddleSpeed = 8; // Adım hızı
                const waddleAmount = 0.15; // Ne kadar yatacağı
                
                // Gövde sallanması (Z ekseni)
                penguinGroup.rotation.z = Math.sin(time * waddleSpeed) * waddleAmount;
                
                // Yürürken hafif zıplama (Y ekseni)
                penguinGroup.position.y = Math.abs(Math.sin(time * waddleSpeed)) * 0.5; 

                // 2. HAREKET MANTIĞI (SONSUZLUK İLLÜZYONU)
                // Penguen aslında ileri gitmiyor (Z ekseninde), Zemin geri gidiyor.
                // Sadece X ekseninde (sağa sola) hareket serbest.
                
                // Sağa sola hareket
                penguinGroup.position.x += moveData.x * 0.5;

                // Sonsuz Zemin Hareketi (Doku Kaydırma yerine zemini fiziksel kaydırıp resetliyoruz)
                // Veya daha basiti: Kamera ve Pengueni sabit tutup diğer her şeyi kaydırmak.
                // Ama burada basitlik için "Ground" texturesini kaydıramadık (standart materyal).
                // O yüzden ZEMİNİ hareket ettirelim.
                
                // Hayır, en iyi yöntem: Penguen olduğu yerde kalsın, biz zeminin ve objelerin
                // Z pozisyonunu değiştirelim.
                
                const speed = moveData.y * 2; // İleri gitme hızı
                
                // Zemin texture offset (eğer texture olsaydı)
                // Buradaki çözüm: Grid helper gibi çizgiler veya zemin üzerindeki detaylar olmadığı için
                // İlerleme hissini DAĞLARIN ve YERDEKİ DETAYLARIN hareketinden alırız.
                
                // Dağları oyuncuya göre hareket ettirme (Paralaks etkisi için çok yavaş)
                // Ama penguen onlara asla ulaşamaz.
                
                // SÜRÜYE ASLA ULAŞAMA MANTIĞI:
                // Sürü hep oyuncunun Z pozisyonunun 2000 birim ilerisinde kalmalı.
                // Aslında oyuncu Z'de hiç ilerlemiyor, hep (0,0,0)'a yakın.
                // Sadece animasyon oynuyoruz.
                
            } else {
                // Dururken yavaşça nefes alıp verme efekti
                if(penguinGroup) {
                    penguinGroup.position.y = THREE.MathUtils.lerp(penguinGroup.position.y, 0, 0.1);
                    penguinGroup.rotation.z = THREE.MathUtils.lerp(penguinGroup.rotation.z, 0, 0.1);
                }
            }
            
            // Kamera takibi (Hafif yumuşak takip - Sadece X ekseninde)
            if(penguinGroup) {
                camera.position.x = THREE.MathUtils.lerp(camera.position.x, penguinGroup.position.x / 2, 0.05);
                camera.lookAt(penguinGroup.position.x, 5, 50);
            }

            renderer.render(scene, camera);
        }

    </script>
</body>
</html>